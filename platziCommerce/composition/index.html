<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Platzi Commerce</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <header>
      <h3>Platzi Commerce</h3>
      <button
        class="cart"
        @click="cartOpen = !cartOpen"
      >
        Carro ({{ cart.length }})
      </button>
      <div class="cart-content"  v-show="cartOpen">
        <div
          class="cart-content__product"
          v-for="(product, index) in cart"
          :key="product.name"
          :class="{ 'bg-gray': index & 1 }"
        >
          <img
            :src="product.images[index].image"
            :alt="product.name"
          >
          <span>
            {{ product.name }} -
            ${{ new Intl.NumberFormat("es-MX").format(product.price) }}
            ({{ product.quantity }})
          </span>
        </div>
      </div>
    </header>
    <main>
      <section class="product">
        <div class="product__thumbnails">
          <div
            v-for="(image, index) in product.images"
            :key="image.thumbnail"
            class="thumb"
            :class="{ active: activeImage === index }"
            :style="{ backgroundImage: `url(${product.images[index].thumbnail})` }"
            @click="activeImage = index"
          >
          </div>
        </div>
        <div class="product__image">
          <img
            :src="product.images[activeImage].image"
            alt="product.name"
          />
        </div>
      </section>
      <section class="description">
        <h4>{{ product.name.toUpperCase() }} {{ product.stock === 0 ? 'ðŸ˜­' : 'ðŸ˜Ž' }}</h4>
        <span
          class="badge new"
          v-if="product.new"
        >
          Nuevo
        </span>
        <span
          class="badge offer"
          v-if="product.offer"
        >
          Oferta
        </span>
        <p
          class="description__status"
          v-if="product.stock <= 10 && product.stock > 1"
        >
          Â¡Quedan pocas unidades!
        </p>
        <p
          class="description__status"
          v-if="product.stock === 1"
        >
          Â¡Queda una unidad!
        </p>
        <p
          class="description__status"
          v-else-if="product.stock === 0"
        >
          Â¡El producto estÃ¡ agotado!
        </p>
        <p
          class="description__status"
          v-else>Quedan {{ product.stock }} unidades disponibles
        </p>
        <p
          class="description__price">
          {{ product.name }} - $ {{ new Intl.NumberFormat("es-MX").format(product.price) }}
        </p>
        <div class="discount">
          <span>CÃ³digo de descuento: </span>
          <input
            type="text"
            placeholder="Ingresa tu cÃ³digo"
            @keyup.enter="applyDiscount($event)"
          >
        </div>
        <button
          :disabled="product.stock === 0"
          @click="addToCart"
        >
          Agregar al carrito
        </button>
      </section>
    </main>
  </div>
  <script src="https://unpkg.com/vue@next"></script>
  <script>
    const { createApp, ref, reactive, toRefs } = Vue;
    const app = createApp({
      setup(){
        const productState = reactive({
          product: {
            name: 'Camara',
            price: 1000,
            stock: 11,
            content: 'Lorem ipsum dolor sit amet consectetur adipisicing elit. Optio vero labore deserunt, incidunt eos, sunt eveniet quidem tempora iste debitis consectetur perferendis ratione velit asperiores mollitia corrupti harum. Error, ab!',
            images: [
              {
                image: "./images/camara.jpg",
                thumbnail: "./images/camara-thumb.jpg",
              },
              {
                image: "./images/camara-2.jpg",
                thumbnail: "./images/camara-2-thumb.jpg",
              }
            ],
            new: true,
            offer: false,
            quantity: 1,
          },
          activeImage: 0
        });

        const cartState = reactive({
          cartOpen: false,
          cart: [],
        });

        function addToCart() {
          const productIndex = cartState.cart.findIndex(product => product.name === productState.product.name);
          if(productIndex >= 0) {
            cartState.cart[productIndex].quantity += 1;
          } else {
            cartState.cart.push(productState.product);
          }
          productState.product.stock -= 1;
        }

        const discountCodes = ref(['Platzi20', 'Mike']);
        function applyDiscount(event) {
          const discountCodeIndex = discountCodes.value.indexOf(event.target.value);
          if(discountCodeIndex >= 0) {
            productState.product.price *= 50 / 100
            discountCodes.value.splice(discountCodeIndex, 1);
            //! Importante usar value para que se refleje en el DOM
          }
        }

        return {
          ...toRefs(productState),
          ...toRefs(cartState),
          addToCart,
          applyDiscount,
        };
      },
    });
    app.mount("#app");
  </script>
</body>
</html>